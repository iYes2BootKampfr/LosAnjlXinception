var LiteDraw_KcTemplateBasic_KcTemplateUGCRichReaction;(function(n){function i(n,i,r){new t(n,i,r)}var t=function(){function n(n,t,i){var r=this,u;if(this.item=[],this.locStrDict=[],this.typeOrderDict=[],this.hoverWidthMap=[],this.enterTime=-1,this.onItemClick=function(n){var t=n.target.getAttribute("data-type"),i=n.target.getAttribute("data-text");t===""?Log.Log("InteractionEvent","UGCRichReaction","UndoReaction",!1,"AppNS",r.nameSpace,"K",r.kValue,"Namespace","KnowledgeCard","EventType","UndoReaction","CustomData",JSON.stringify({itemType:i})):Log.Log("InteractionEvent","UGCRichReaction","Reaction",!1,"AppNS",r.nameSpace,"K",r.kValue,"Namespace","KnowledgeCard","EventType","Reaction","CustomData",JSON.stringify({itemType:i}));r.sendReaction(t)},this.onItemMouseEnter=function(n){Array.prototype.forEach.call(r.hoverItemsEl.querySelectorAll(".l_ecrd_rrct-hover-item")||[],function(t){t!==n.target&&t.classList.add("unactived")});n.target.classList.add("actived");Array.prototype.forEach.call(n.target.querySelectorAll(".l_ecrd_rrct-hover-item-emoji-pic")||[],function(n){n.classList.add("actived")});Array.prototype.forEach.call(n.target.querySelectorAll(".l_ecrd_rrct-hover-item-emoji-hover")||[],function(n){n.classList.add("actived")})},this.onItemMouseLeave=function(n){Array.prototype.forEach.call(r.hoverItemsEl.querySelectorAll(".l_ecrd_rrct-hover-item")||[],function(n){n.classList.remove("unactived");n.classList.remove("actived")});Array.prototype.forEach.call(n.target.querySelectorAll(".l_ecrd_rrct-hover-item-emoji-pic")||[],function(n){n.classList.remove("unactived");n.classList.remove("actived")});Array.prototype.forEach.call(n.target.querySelectorAll(".l_ecrd_rrct-hover-item-emoji-hover")||[],function(n){n.classList.remove("unactived");n.classList.remove("actived")})},this.id=n.Id,this.satoriId=n.SatoriId,this.userReactionType=n.UserReactionType,this.nameSpace=t,this.kValue="".concat(i),this.item=n.Items,this.totalCount=n.TotalCount,this.typeList=n.TypeStr.split(","),this.reactionEl=document.getElementById("richreaction-".concat(n.Id)),this.reactionEl!==null){for(this.hoverEl=this.reactionEl.querySelector(".l_ecrd_rrct-hover"),this.itemsEl=this.reactionEl.querySelector(".l_ecrd_rrct-items"),this.itemsAddEl=this.reactionEl.querySelector(".l_ecrd_rrct-item.add"),this.totalEl=this.reactionEl.querySelector(".l_ecrd_rrct-total"),this.hoverItemsEl=this.reactionEl.querySelector(".l_ecrd_rrct-hover-items"),this.locStrDict.Love=n.LoveLocStr,this.locStrDict.Like=n.LikeLocStr,this.locStrDict.Surprised=n.SurprisedLocStr,this.locStrDict.Sad=n.SadLocStr,this.locStrDict.Angry=n.AngryLocStr,this.locStrDict.Dislike=n.DislikeLocStr,this.locStrDict.Undo=n.UndoLocStr,this.hoverWidthMap[2]=100,this.hoverWidthMap[3]=122,this.hoverWidthMap[5]=244,u=0;u<this.typeList.length;u++)this.typeOrderDict[this.typeList[u]]=u;if(this.hoverEl===null||this.itemsEl===null||this.itemsAddEl===null||this.totalEl===null||this.hoverItemsEl===null)throw new Error("UGC: can't find element!");this.setItemImg();this.init();this.reactionEl.classList.remove("is-loading");setTimeout(function(){r.setResult()},500)}}return n.prototype.init=function(){var t=this,i,n;this.reactionEl!==null&&(i=this.reactionEl.querySelectorAll(".l_ecrd_rrct-hover-item"),Array.prototype.forEach.call(i||[],function(n){t.userReactionType;sj_be(n,"click",t.onItemClick)}),sj_be(this.reactionEl,"mouseenter",function(){t.setShowHover(!0);n!=-1&&(clearTimeout(n),n=-1)}),n=-1,sj_be(this.reactionEl,"mouseleave",function(){n===-1&&(n=setTimeout(function(){t.setShowHover(!1);n=-1},200))}),sj_be(this.hoverEl,"mouseenter",function(){n!=-1&&(clearTimeout(n),n=-1)}),sj_be(this.hoverEl,"mouseleave",function(){n===-1&&(n=setTimeout(function(){t.setShowHover(!1);n=-1},200))}))},n.prototype.setShowHover=function(n){var u;if(n){this.enterTime=sb_gt();this.hoverEl.classList.add("show");var r=this.hoverWidthMap[this.typeList.length],t=this.reactionEl.getBoundingClientRect(),i=this.reactionEl.parentElement.parentElement.getBoundingClientRect();t.left-i.left<r/2-t.width/2?(this.hoverEl.style.left="".concat(i.left-t.left,"px"),this.hoverEl.style.right=""):i.right-t.right<r/2-t.width/2?(this.hoverEl.style.left="",this.hoverEl.style.right="".concat(t.right-i.right,"px")):(this.hoverEl.style.left="".concat(t.width/2-r/2,"px"),this.hoverEl.style.right="")}else this.enterTime!==-1&&(u=sb_gt()-this.enterTime,this.enterTime=-1,Log.Log("InteractionEvent","UGCRichReaction","Hover",!1,"AppNS",this.nameSpace,"K",this.kValue,"NameSpace","KnowledgeCard","EventType","Hover","CustomData",JSON.stringify({duration:u}))),this.hoverEl.classList.remove("show")},n.prototype.sendReaction=function(n){var i=this,r="".concat(this.nameSpace,".").concat(this.kValue),u="/lite/gj?q=UGCRichReaction^".concat(this.id,"^^^^&IID=").concat(r,"&IG=").concat(_G.IG),f=JSON.stringify({id:this.id,satoriId:this.satoriId,type:n}),t=sj_gx();t.open("POST",u,!0);t.setRequestHeader("Content-Type","application/json");t.onreadystatechange=function(){if(t.readyState===4&&t.status==200){var n=JSON.parse(t.responseText);n.Status==="Ok"&&(i.item=n.SubReactionSummaries,i.userReactionType=n.UserReactionType,i.setResult())}};t.send(f)},n.prototype.setItemImg=function(){Array.prototype.forEach.call(this.reactionEl.querySelectorAll(".l_ecrd_rrct-item")||[],function(n){var t=n.getAttribute("data-type");t&&n.classList.add("icon-".concat(t))});this.totalEl.style.visibility="visible"},n.prototype.setResult=function(){var n=this,u,i,f,h,r,e,o,t,s,c;for(Array.prototype.forEach.call(this.reactionEl.querySelectorAll(".l_ecrd_rrct-item:not(.icon-Add)")||[],function(n){n.remove()}),Array.prototype.forEach.call(this.hoverItemsEl.querySelectorAll(".l_ecrd_rrct-hover-item")||[],function(n){n.remove()}),u={},i=0,f=this.item;i<f.length;i++)h=f[i],u[h.Type]=!0;for(r=0,e=this.typeList;r<e.length;r++)o=e[r],u[o]||this.item.push({Type:o,Count:"0"});t=this.typeOrderDict;this.item.sort(function(n,i){return n.Count!==i.Count?Number(i.Count)-Number(n.Count):t[n.Type]===undefined?1:t[i.Type]===undefined?-1:t[n.Type]-t[i.Type]});s=0;c=0;Array.prototype.forEach.call(this.item||[],function(t){var o,a,r,h,i,u,f,e,l,v;n.typeList.indexOf(t.Type)<0||(o=parseInt(t.Count,10),s+=o,++c<=1&&(o>0?(a=document.createElement("div"),a.className="l_ecrd_rrct-item icon-".concat(t.Type),n.itemsEl.insertBefore(a,n.totalEl),n.totalEl.innerText="".concat(o),n.reactionEl.classList.add("actived")):(n.totalEl.innerText="",n.reactionEl.classList.remove("actived"))),r="",h=t.Type===n.userReactionType,h||(r=t.Type),i=document.createElement("div"),i.classList.add("l_ecrd_rrct-hover-item"),u=document.createElement("div"),u.classList.add("l_ecrd_rrct-hover-item-emoji"),i.appendChild(u),o>0&&(f=document.createElement("div"),f.className="l_ecrd_rrct-hover-item-number",f.setAttribute("data-type",r),f.setAttribute("data-text",t.Type),f.innerText=t.Count,i.appendChild(f)),e=document.createElement("div"),e.classList.add("l_ecrd_rrct-hover-item-emoji-pic"),e.classList.add("icon-".concat(t.Type)),e.setAttribute("data-type",r),e.setAttribute("data-text",t.Type),u.appendChild(e),l=document.createElement("div"),l.className="l_ecrd_rrct-hover-item-emoji-hover",l.innerText=h?n.locStrDict.Undo:n.locStrDict[r],u.appendChild(l),v=document.createElement("div"),v.className="l_ecrd_rrct-hover-item-emoji-underline",h&&u.appendChild(v),i.setAttribute("data-type",r),i.setAttribute("data-text",t.Type),n.hoverItemsEl.appendChild(i),sj_be(i,"click",n.onItemClick),sj_be(i,"mouseenter",n.onItemMouseEnter),sj_be(i,"mouseleave",n.onItemMouseLeave))});this.totalCount=s.toString()},n}();"remove"in Element.prototype||(HTMLElement.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});n.i=i})(LiteDraw_KcTemplateBasic_KcTemplateUGCRichReaction||(LiteDraw_KcTemplateBasic_KcTemplateUGCRichReaction={}))